# Система выплат BetsBot

## Описание

Система выплат для Telegram Web App, работающая на PHP + MySQL. Позволяет пользователям пополнять баланс и выводить средства через криптовалютные кошельки.

## Установка

### 1. База данных

1. Откройте phpMyAdmin
2. Импортируйте файл `api/database.sql`
3. Проверьте настройки подключения в `api/config.php`:
   - `DB_HOST` - хост БД (обычно `localhost`)
   - `DB_NAME` - имя БД (по умолчанию `betsbot_db`)
   - `DB_USER` - пользователь БД (обычно `root`)
   - `DB_PASS` - пароль БД (обычно `root`)

### 2. Настройка пароля администратора

Пароль по умолчанию: `Admin@2024!Secure#Pass`

Для изменения пароля:
1. Войдите в админ панель (`/admin/index.html`)
2. Перейдите в раздел "Settings"
3. Измените пароль

### 3. Настройка кошельков

1. Войдите в админ панель
2. Перейдите в раздел "Settings"
3. Укажите адреса кошельков для пополнения (USDT, BTC, ETH)
4. Нажмите "Сохранить кошельки"

## Функционал

### Для пользователей

1. **Автоматическая регистрация**: При первом заходе автоматически создается аккаунт с рандомным session_token (сохраняется в cookies)

2. **Пополнение баланса**:
   - Перейдите в раздел "Кошелёк"
   - Скопируйте адрес кошелька для нужной криптовалюты
   - Отправьте средства на указанный адрес
   - Нажмите "Я отправил депозит"
   - Введите сумму и хэш транзакции
   - Заявка попадет в админ панель на подтверждение

3. **Вывод средств**:
   - Перейдите в раздел "Кошелёк"
   - Нажмите "Создать заявку"
   - Введите сумму, адрес кошелька и выберите валюту
   - Заявка попадет в админ панель
   - Администратор вручную отправляет средства и подтверждает заявку

4. **История операций**:
   - Кнопки "История пополнений" и "Мои выплаты" показывают все заявки с их статусами

### Для администраторов

1. **Вход**: Откройте `/admin/index.html` и введите пароль

2. **Dashboard**: Общая статистика (пользователи, ставки, заявки)

3. **Users**: 
   - Просмотр всех пользователей
   - Редактирование кредитных лимитов
   - Поиск по Telegram username или ID

4. **Deposits**:
   - Просмотр всех заявок на пополнение
   - Подтверждение или отклонение заявок
   - При подтверждении баланс пользователя автоматически пополняется

5. **Payouts**:
   - Просмотр всех заявок на вывод
   - Подтверждение или отклонение заявок
   - При отклонении баланс возвращается пользователю

6. **Settings**:
   - Управление адресами кошельков для пополнения
   - Изменение пароля администратора

## API Endpoints

### Пользовательские

- `POST /api/auth.php?action=init` - Инициализация/создание пользователя
- `GET /api/auth.php` - Получение текущего пользователя
- `GET /api/wallet.php` - Получение адресов кошельков
- `POST /api/deposits.php` - Создание заявки на пополнение
- `GET /api/deposits.php` - История пополнений
- `POST /api/withdrawals.php` - Создание заявки на вывод
- `GET /api/withdrawals.php` - История выводов

### Администраторские

- `POST /api/admin.php?action=login` - Вход в админку
- `GET /api/admin.php?action=stats` - Статистика
- `GET /api/admin.php?action=users` - Список пользователей
- `POST /api/admin.php?action=update-limit` - Обновление лимита пользователя
- `GET /api/admin.php?action=deposits` - Список заявок на пополнение
- `POST /api/admin.php?action=process-deposit` - Обработка заявки на пополнение
- `GET /api/admin.php?action=withdrawals` - Список заявок на вывод
- `POST /api/admin.php?action=process-withdrawal` - Обработка заявки на вывод
- `GET /api/admin.php?action=wallets` - Получение кошельков
- `POST /api/admin.php?action=update-wallets` - Обновление кошельков
- `POST /api/admin.php?action=change-password` - Изменение пароля

## Структура базы данных

- `users` - Пользователи
- `deposits` - Заявки на пополнение
- `withdrawals` - Заявки на вывод
- `admin_settings` - Настройки (пароль, кошельки)
- `admin_sessions` - Сессии администраторов

## Безопасность

- Пароли хранятся в виде bcrypt хэшей
- Сессии используют токены
- Все запросы проверяют авторизацию
- CORS настроен для работы с фронтендом

## Интеграция с Telegram

Система автоматически определяет данные Telegram пользователя через Telegram Web App API и сохраняет их в базе данных при первом входе.

## Примечания

- Все суммы хранятся в формате DECIMAL(15,2)
- Статусы заявок: `pending`, `approved`, `rejected`
- При подтверждении пополнения баланс автоматически увеличивается
- При создании заявки на вывод баланс сразу списывается
- При отклонении вывода баланс возвращается пользователю
